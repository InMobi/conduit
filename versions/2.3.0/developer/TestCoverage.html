<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- Generated by Apache Maven Doxia Site Renderer 1.3 at Jul 8, 2014 -->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title>Conduit - Publish Missing Path Cases</title>
    <style type="text/css" media="all">
      @import url("../css/maven-base.css");
      @import url("../css/maven-theme.css");
      @import url("../css/site.css");
    </style>
    <link rel="stylesheet" href="../css/print.css" type="text/css" media="print" />
    <meta name="Date-Revision-yyyymmdd" content="20140708" />
    <meta http-equiv="Content-Language" content="en" />
        
        </head>
  <body class="composite">
    <div id="banner">
                    <div id="bannerLeft">
                Conduit
                </div>
                    <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="breadcrumbs">
            
            
                <div class="xleft">
        <span id="publishDate">Last Published: 2014-07-08</span>
                  &nbsp;| <span id="projectVersion">Version: 2.3.0</span>
                          |                           <a href="http://github.com/inmobi/" class="externalLink" title="InMobi">InMobi</a>
        &gt;
                          <a href="http://github.com/inmobi/conduit" class="externalLink" title="Conduit">Conduit</a>
        &gt;
    Publish Missing Path Cases
              </div>
            <div class="xright">        
            
      </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="leftColumn">
      <div id="navcolumn">
             
            
                                <h5>Conduit</h5>
                  <ul>
                  <li class="none">
                          <a href="../index.html" title="Conduit">Conduit</a>
            </li>
                  <li class="none">
                          <a href="../developer/Overview.html" title="Overview">Overview</a>
            </li>
                  <li class="none">
                          <a href="../developer/Design.html" title="Design">Design</a>
            </li>
                  <li class="none">
                          <a href="../DevSetup/DevSetup.html" title="Dev setup">Dev setup</a>
            </li>
                  <li class="none">
                          <a href="../ConduitLite/ConduitLite.html" title="ConduitLite">ConduitLite</a>
            </li>
                  <li class="none">
                          <a href="../Audit/Audit.html" title="Audit">Audit</a>
            </li>
                  <li class="none">
                          <a href="../Visualization/Visualization.html" title="Visualization">Visualization</a>
            </li>
                  <li class="none">
                          <a href="../Admin/AdminScript.html" title="Admin Script">Admin Script</a>
            </li>
                  <li class="none">
                          <a href="../Monitoring/MonitoringConduit.html" title="Monitoring">Monitoring</a>
            </li>
          </ul>
                       <h5>Project Documentation</h5>
                  <ul>
                                                                                                                                                                                <li class="collapsed">
                          <a href="../project-info.html" title="Project Information">Project Information</a>
                  </li>
                                                                    <li class="collapsed">
                          <a href="../project-reports.html" title="Project Reports">Project Reports</a>
                  </li>
          </ul>
                                                                                                                                     <a href="http://www.inmobi.com/" title="inmobi" class="poweredBy">
        <img class="poweredBy"  alt="inmobi" src="../../images/inmobi-logo.jpg"     />
      </a>
                       
            
            </div>
    </div>
    <div id="bodyColumn">
      <div id="contentBox">
        <div class="section"><h2>Publish Missing Path Cases <a name="Publish_Missing_Path_Cases"></a></h2><div class="section"><h3>Common Scenarios<a name="Common_Scenarios"></a></h3><ol style="list-style-type: decimal"><li>no traffic on any of the threads</li><li>job taking more time to run -&gt; pause job tracker, task tracker to cause job to take more time.</li><li>worker is down for sometime.</li><li>conduit worker fails to commit for 2-3 runs -&gt; change permissions for /conduit/streams_local/ from w+</li><li>kill -9 on conduit worker</li></ol><div class="section"><h4>LocalStreamService <a name="LocalStreamService"></a></h4><ol style="list-style-type: decimal"><li>All the above common scenarios applicable</li></ol></div><div class="section"><h4>MergedStream <a name="MergedStream"></a></h4><ol style="list-style-type: decimal"><li>no traffic on both the threads</li><li>no traffic to one of the threads</li><li>traffic to both of them</li><li>failure in distcp job because the actual data doesn't exist</li><li>doLocalCommit stage failure in merged stream service by changing the permissions of actual destination</li><li>do <a href="./FinalCommit.html">FinalCommit</a> failure by again changing permissions of the right folder.</li></ol></div><div class="section"><h4>MirrorStream <a name="MirrorStream"></a></h4><p>1. check that mirror and merged stream are exactly same in all the above scenarios</p><table border="1" class="bodyTable"><caption>We have following Test Cases for Respective Services Covering Different Scenarios</caption><tr class="a"><td align="center">Test Case Scenario <i>p</i>ConduitConfigParser should parse the XML correctly<i>/p</i> <i>p</i>and populate all the values, should have correct<i>/p</i> <i>p</i><i>/p</i><i>p</i>List of All Streams,Clusters,<i>/p</i> <i>p</i>Source and Destination Streams<i>/p</i> <i>p</i><i>/p</i><i>p</i>Predefined xml as input<i>/p</i> <i>p</i><a href="#a"></a><i>/p</i>*----*--*--*--*--* cluster objects, defaults and streams <i>p</i> <i>/p</i> <i>p</i>ConduitConfigParser should throw an Exception for<i>/p</i> <i>p</i><i>/p</i><i>p</i>Exception for unknown values<i>/p</i> <i>p</i>undefined clusters, two merge streams<i>/p</i> <i>p</i><i>/p</i><i>p</i>Malformed xml, xml with invalid<i>/p</i> <i>p</i><i>/p</i>*----*--*--*--*--* incorrect values in XML <i>p</i> <i>/p</i> <i>p</i>ConduitConfigParser should load conduit.xml found<i>/p</i> <i>p</i>in classpath if null filename is passed, if not found<i>/p</i> <i>p</i><i>/p</i>*----*--*--*--*--* should throw Exception <i>p</i> <i>/p</i> <i>p</i>Cluster should have all the fields as per Contract,<i>/p</i> <i>p</i><i>/p</i><a href="#a"></a>*----*--*--*--*--* e.g: hdfsUrl, rootdir etc <i>p</i> <i>/p</i> <i>p</i>Checkpoint should be created correctly, written and<i>/p</i> <i>p</i><i>/p</i><i>p</i>checkpoint predefined value is read<i>/p</i> <i>p</i><i>/p</i><i>p</i>provide checkpoints with predefined<i>/p</i> <i>p</i><i>/p</i>*----*--*--*--*--* Read Correctly <i>p</i> <i>/p</i> <i>p</i>Conduit should read cfg file correctly, should populate<i>/p</i> <i>p</i>services correctly as per xml, local, merge and purger<i>/p</i> <i>p</i><i>/p</i><i>p</i>should populate correct services<i>/p</i> <i>p</i><i>/p</i><i>p</i>pre defined xml with list of services<i>/p</i> <i>p</i><i>/p</i>*----*--*--*--*--* services <i>p</i>should return milliseconds to run until<i>/p</i> <i>p</i><i>/p</i>*----*--*--*--*--* Services should return expected Milliseconds to run <i>p</i> <i>/p</i> <i>p</i>Services should create/publish all the Missing Paths,<i>/p</i> <i>p</i><i>/p</i><i>p</i>all the missing paths are published<i>/p</i> <i>p</i>correctly from the dummy path<i>/p</i> <i>p</i><i>/p</i><i>p</i>create a pre defined path at an<i>/p</i> <i>p</i><i>/p</i>*----*--*--*--*--* local/merge/mirror streams <i>p</i> <i>/p</i> <i>p</i>Create a LocalStreamService for one of the clusters<i>/p</i> <i>p</i><i>/p</i><i>p</i>End to End Local Stream Service<i>/p</i> <i>p</i><i>/p</i><i>p</i>Pre defined xml for localstream<i>/p</i> <i>p</i><i>/p</i>*----*--*--*--*--* for integration Tests <i>p</i> <i>/p</i> <i>p</i>Create dummy paths in data directory and verify<i>/p</i> <i>p</i>all the paths are correctly listed by localstreamservice<i>/p</i> <i>p</i><i>/p</i><i>p</i>CreateListing returns all the expected<i>/p</i> <i>p</i><i>/p</i><i>p</i>Create dummy paths in data<i>/p</i> <i>p</i>directory and expected results.<i>/p</i> <i>p</i><i>/p</i>*----*--*--*--*--* createlisting <i>p</i> <i>/p</i> <i>p</i>Run the service using MiniMRCluster should create<i>/p</i> <i>p</i>all the paths except currentfile in streams_local<i>/p</i> <i>p</i><i>/p</i><i>p</i>End to End LocalStream Service<i>/p</i> <i>p</i><i>/p</i>*----*--*--*--*--* directory and make sure current file is not part of it <i>p</i> <i>/p</i> <i>p</i>After running the service check that trash paths are<i>/p</i> <i>p</i>populated correctly with all the paths except current<i>/p</i> <i>p</i><i>/p</i><i>p</i>Make sure there are all files but 6<i>/p</i> <i>p</i><i>/p</i><i>p</i>create dummy data and run<i>/p</i> <i>p</i><i>/p</i>*----*--*--*--*--* file + 6 files <i>p</i> <i>/p</i> <i>p</i>Make sure only 6 + current file is present in the<i>/p</i> <i>p</i><i>/p</i><i>p</i>Make sure 6 + current file is present<i>/p</i> <i>p</i><i>/p</i><i>p</i>create dummy data and<i>/p</i> <i>p</i><i>/p</i>*----*--*--*--*--* data directory <i>p</i> <i>/p</i> <i>p</i>Make sure the checkpoint file is the last file in the<i>/p</i> <i>p</i><i>/p</i><i>p</i>Make sure that current file - 1 is<i>/p</i> <i>p</i><i>/p</i>*----*--*--*--*--* streams_local directory <i>p</i> <i>/p</i> <i>p</i>Repeat the above localstream service for additional<i>/p</i> <i>p</i><i>/p</i><i>p</i>verify that there is no data replay<i>/p</i> <i>p</i><i>/p</i>*----*--*--*--*--* files in data directory <i>p</i> <i>/p</i> <i>p</i>Using the above LocalStreamService as the basis,<i>/p</i> <i>p</i>test MergedStream service by defining only merged<i>/p</i> <i>p</i><i>/p</i>*----*--*--*--*--* stream cluster <i>p</i> <i>/p</i> <i>p</i>Run the MergedStreamService after localstreamservice<i>/p</i> <i>p</i>make sure all the paths are present in streams<i>/p</i> <i>p</i><i>/p</i>*----*--*--*--*--* directory <a href="#a"></a>*----*--*--*--*--* Verify about the ./MissingPaths.htmlMissingPaths <i>p</i> <i>/p</i> <i>p</i>Repeat the same above for another cycle for<i>/p</i> <i>p</i><i>/p</i>*----*--*--*--*--* mergedstreamservice <i>p</i> <i>/p</i> <i>p</i>Define a MirrorStream service in another xml<i>/p</i> <i>p</i><a href="#a"></a><i>/p</i>*----*--*--*--*--* and run Local and ./MergedStream.htmlMergedStream service <a href="#a"></a>*----*--*--*--*--* Verify the paths in streams folder for ./MirrorStreamService.htmlMirrorStreamService <a href="#a"></a>*----*--*--*--*--* Verify publishing of missing paths for ./MirrorStreamService.htmlMirrorStreamService</td><td align="center">Test Case Type +ve -ve +ve +ve +ve +ve +ve +ve +ve +ve +ve +ve +ve +ve +ve +ve +ve +ve +ve +ve +ve +ve</td><td align="center">Implemented Yes No Yes Yes Yes Yes Yes Yes Yes Yes Yes Yes Yes Yes Yes Yes Yes Yes No Yes Yes Yes</td><th align="center">Expected Output as specified in pre defined xml other invalid values Part of ./ConduitConfigParser.htmlConduitConfigParser Tests and written correctly as per predefined xml next minute boundry creation to now contracts is validated paths same as above present in trash directory in data directory the checkpoint all the above tests are repeated verify contract for merged stream same as above Verify contract for mirror stream</th><th align="center">Input Data/Files to ./ConduitConfigParser.htmlConduitConfigParser values value needs to be populated provide pre defined commit time earlier date aka dummy path service only. localstream service run localstream service</th></tr><tr class="b"><td align="center">Make sure there are no exceptions for any runs above</td><td align="center">+ve</td><td align="center">Yes</td><th align="center"></th><th align="center"></th></tr><tr class="a"><td align="center">Repeat the above for another run with new data</td><td align="center">+ve</td><td align="center">No</td><th align="center"></th><th align="center"></th></tr><tr class="b"><td align="center">Repeat above for another run without new data <i>p</i> <i>/p</i> <i>p</i>Create a Purger Test Service and verify that purging<i>/p</i> <i>p</i>is done correctly for date and retentioninhours should return<i>/p</i> <i>p</i><i>/p</i>*----*--*--*--*--* true/false respectively <i>p</i> <i>/p</i> <i>p</i>Run end to end service tests for purger service, create paths in<i>/p</i> <i>p</i>streams_local and run the purger service for different times and<i>/p</i> <i>p</i>verify that paths are deleted or retained depending<i>/p</i> <i>p</i><i>/p</i>*----*--*--*--*--* on retentionperiod <i>p</i> <i>/p</i> <i>p</i>Run end to end service tests for purger service, create paths in<i>/p</i> <i>p</i>streams and run the purger service for different times and<i>/p</i> <i>p</i><i>/p</i>*----*--*--*--*--* verify that paths are deleted or retained depending <i>p</i> <i>/p</i> <i>p</i>Run end to end service tests for purger service, create paths in<i>/p</i> <i>p</i>streams and run the purger service for different times and<i>/p</i> <i>p</i><i>/p</i>*----*--*--*--*--* verify that paths are deleted or retained depending</td><td align="center">+ve +ve +ve +ve +ve</td><td align="center">No Yes Yes Yes Yes</td><th align="center"></th><th align="center"></th></tr><tr class="a"><td align="center">Run the purger service again with new data <i>p</i> <i>/p</i> <i>p</i>Run the purger service again with no new data, shouldnt throw<i>/p</i> <i>p</i><i>/p</i>*----*--*--*--*--* and exception</td><td align="center">+ve -ve</td><td align="center">No No</td><th align="center"></th><th align="center"></th></tr></table></div></div><div class="section"><h3>Conduit-Core<a name="Conduit-Core"></a></h3><p>Has 64% Coverage for following Scenarios</p><p>* <a href="./TestCluster.html">TestCluster</a>.java - testBasicCluster - Uses test-conduit.xml and makes sure that teh cluster values are correctly populated with known values. For e.g hdfsurl, etc. Defines only a single cluster. Improvement of having multiple clusters defined in xml.</p><p>* <a href="./TestConduitConfigParser.html">TestConduitConfigParser</a> - Builds a localcluster of known xml test-conduit.xml and compares it to known values. Creates a new xml of known values and compares the same making sure all the values are correctly parsed.</p><p>* <a href="./TestFileCheckpointProvider.html">TestFileCheckpointProvider</a> - Creates a checkpoint and reads it making sure the checkpoint is saved correctly.</p><p>* TestFSCheckpointProvider - Tests the same as above with and without HDFS.</p></div><div class="section"><h3>Conduit-Worker<a name="Conduit-Worker"></a></h3><p>Has 68% Coverage for following Scenarios</p><p>* <a href="./AbstractServiceTest.html">AbstractServiceTest</a> - Makes sure that milliseconds to next run fall on next minute boundry.</p><p>* <a href="./DataPurgerServiceTest.html">DataPurgerServiceTest</a> - Covers the following</p><ul><li>isPurgeTest* - Covers various scenarious where the time is advanced and forwarded and made sure isPurge method returns the correct status.</li></ul><ul><li>testDefaultRetentionTimes - Parses the xml test-retention-conduit.xml and makes sure the retention times are as mentioned in the xml and also verifies that for streams not defined in the xml a default value as mentioned in xml is returned.</li></ul><ul><li>testPurgerService - Creates services with different values from xml and creates test files and makes sure that merge,local and trash are cleared appropriately. Using different current times.</li></ul><p>* <a href="./TestCreateListing.html">TestCreateListing</a> - Verfies that created files are populated correctly, trashset and checkpoints doesnt run the Mapper. Calls <a href="./LocalStreamService.html">LocalStreamService</a> <a href="./CreateListing.html">CreateListing</a> Method to Verify.</p><p>* testMapReduce - Does a Integration test for LocalStreamService, End to End. Creates the data in data folder, Runs the mapper, Verfies that all the compressed files are created, verfies that 6 files are present from checkpoint backwards, makes sure that current file is not moved. Checks for Missing Paths. Makes sure that all trash contains the expected files totalnumberoffiles - 6 - currentfile.</p><p>* <a href="./MergeMirrorStreamTest.html">MergeMirrorStreamTest</a> - Covers the following</p><ul><li>testMergeMirrorStream - Runs the service End to End for 2 xml one which defines only the MergeStream and MirrorStream for 1 cluster each and other one 1 Merge and 2 Mirror Streams, Makes sure that LocalStreamService works correctly, Makes sure that data for MergeStream is correctly published and the same for MirrorStream. Tests for Missing Paths for MergedStreamService only.</li></ul><p>1. Makes sure the debian package is correctly installed on both the dev machines.</p><p>2. Define xml which contains <a href="./MergedStream.html">MergedStream</a>, Should test <a href="./MirrorStream.html">MirrorStream</a> as well.</p><p>3. Run the benchmark test for LOCAL,COLLECTOR and MERGED and make sure data is validated in all cases.</p><p>4. Make sure data is correctly published in data folder in order and timestamps are correct.</p><p>5. Make sure localstream service correctly published data and the commit times are correct and all the files except the current file is published.</p><p>6. Verify that trash paths are correctly populated.</p><p>7. Verify the Purger service purges all the paths which exceeds retentionperiod, try with 2 hours once for trash and other for streams. Change at stream level and make sure its reflected.</p><p>8. Verify that Merged Stream service correctly publishes all the paths.</p><p>9. In all the above cases make sure there are no exceptions.</p><p>10. Pump multiple streams and verify that conduit behaves correctly and no exceptions.</p><p>11. Run benchmark for multiple streams, with multiple producers.</p></div></div>
      </div>
    </div>
    <div class="clear">
      <hr/>
    </div>
    <div id="footer">
      <div class="xright">
              Copyright &#169;                    2014
                        <a href="https://github.com/InMobi">InMobi</a>.
            All Rights Reserved.      
            
                  </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
  </body>
</html>
