<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- Generated by Apache Maven Doxia Site Renderer 1.3 at Feb 28, 2014 -->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title>Conduit - Publish Missing Path Cases </title>
    <style type="text/css" media="all">
      @import url("../css/maven-base.css");
      @import url("../css/maven-theme.css");
      @import url("../css/site.css");
    </style>
    <link rel="stylesheet" href="../css/print.css" type="text/css" media="print" />
    <meta name="Date-Revision-yyyymmdd" content="20140228" />
    <meta http-equiv="Content-Language" content="en" />
        
        </head>
  <body class="composite">
    <div id="banner">
                    <div id="bannerLeft">
                Conduit
                </div>
                    <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="breadcrumbs">
            
            
                <div class="xleft">
        <span id="publishDate">Last Published: 2014-02-28</span>
                  &nbsp;| <span id="projectVersion">Version: 2.2.8-SNAPSHOT</span>
                          |                           <a href="http://github.com/inmobi/" class="externalLink" title="InMobi">InMobi</a>
        &gt;
                          <a href="http://github.com/inmobi/conduit" class="externalLink" title="Conduit">Conduit</a>
        &gt;
    Publish Missing Path Cases 
              </div>
            <div class="xright">        
            
      </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="leftColumn">
      <div id="navcolumn">
             
            
                                <h5>Conduit</h5>
                  <ul>
                  <li class="none">
                          <a href="../index.html" title="Conduit">Conduit</a>
            </li>
                  <li class="none">
                          <a href="../developer/Overview.html" title="Overview">Overview</a>
            </li>
                  <li class="none">
                          <a href="../developer/Design.html" title="Design">Design</a>
            </li>
                  <li class="none">
                          <a href="../developer/DevSetup.html" title="Dev setup">Dev setup</a>
            </li>
                  <li class="none">
                          <a href="../developer/ConduitLite.html" title="ConduitLite">ConduitLite</a>
            </li>
                  <li class="none">
                          <a href="../developer/Audit.html" title="Audit">Audit</a>
            </li>
                  <li class="none">
                          <a href="../developer/Visualization.html" title="Visualization">Visualization</a>
            </li>
                  <li class="none">
                          <a href="../developer/AdminScript.html" title="Admin Script">Admin Script</a>
            </li>
          </ul>
                       <h5>Modules</h5>
                  <ul>
                  <li class="none">
                          <a href="../conduit-core/index.html" title="Conduit Core">Conduit Core</a>
            </li>
                  <li class="none">
                          <a href="../conduit-distcp/index.html" title="Conduit Distcp">Conduit Distcp</a>
            </li>
                  <li class="none">
                          <a href="../conduit-worker/index.html" title="Conduit Worker">Conduit Worker</a>
            </li>
                  <li class="none">
                          <a href="../conduit-dist/index.html" title="Conduit Distribution">Conduit Distribution</a>
            </li>
                  <li class="none">
                          <a href="../conduit-audit/index.html" title="Conduit Audit">Conduit Audit</a>
            </li>
                  <li class="none">
                          <a href="../conduit-visualization/index.html" title="Conduit Visualization">Conduit Visualization</a>
            </li>
          </ul>
                       <h5>Project Documentation</h5>
                  <ul>
                                                                                                                                                                                <li class="collapsed">
                          <a href="../project-info.html" title="Project Information">Project Information</a>
                  </li>
                                                                    <li class="collapsed">
                          <a href="../project-reports.html" title="Project Reports">Project Reports</a>
                  </li>
          </ul>
                                                                                                                                     <a href="http://www.inmobi.com/" title="inmobi" class="poweredBy">
        <img class="poweredBy"  alt="inmobi" src="../../images/inmobi-logo.jpg"     />
      </a>
                       
            
            </div>
    </div>
    <div id="bodyColumn">
      <div id="contentBox">
        <div class="section"><h3>Publish Missing Path Cases <a name="Publish_Missing_Path_Cases"></a></h3></div><div class="section"><h4>Common Scenarios<a name="Common_Scenarios"></a></h4><p></p><ol style="list-style-type: decimal"><li>no traffic on any of the threads</li><li>job taking more time to run -&gt; pause job tracker, task tracker to cause job to take more time.</li><li>worker is down for sometime.</li><li>conduit worker fails to commit for 2-3 runs -&gt; change permissions for /conduit/streams_local/ from w+</li><li>kill -9 on conduit worker</li></ol></div><div class="section"><h4>LocalStreamService <a name="LocalStreamService"></a></h4><p></p><ol style="list-style-type: decimal"><li>All the above common scenarios applicable</li></ol></div><div class="section"><h4>MergedStream  <a name="MergedStream"></a></h4><p></p><ol style="list-style-type: decimal"><li>no traffic on both the threads</li><li>no traffic to one of the threads</li><li>traffic to both of them</li><li>failure in distcp job because the actual data doesn't exist</li><li>doLocalCommit stage failure in merged stream service by changing the permissions of actual destination</li><li>do <a href="./FinalCommit.html">FinalCommit</a> failure by again changing permissions of the right folder.</li></ol></div><div class="section"><h4>MirrorStream <a name="MirrorStream"></a></h4><p>1. check that mirror and merged stream are exactly same in all the above scenarios</p><p></p><table border="0" class="bodyTable"><tr class="a"><th>Test Case Scenario</th><th>Test Case Type</th><th>Implemented</th><th>Expected Output</th><th>Input Data/Files</th></tr><tr class="b"><td><p>ConduitConfigParser should parse the XML correctly</p> <p>and populate all the values, should have correct</p> <p>cluster objects, defaults and streams</p></td><td>+ve</td><td>Yes</td><td><p>List of All Streams,Clusters,</p> <p>Source and Destination Streams</p> <p>as specified in pre defined xml</p></td><td><p>Predefined xml as input</p> <p>to <a href="./ConduitConfigParser.html">ConduitConfigParser</a></p></td></tr><tr class="a"><td><p> </p> <p>ConduitConfigParser should throw an Exception for</p> <p>incorrect values in XML</p></td><td>-ve</td><td>No</td><td><p>Exception for unknown values</p> <p>undefined clusters, two merge streams</p> <p>other invalid values</p></td><td><p>Malformed xml, xml with invalid</p> <p>values</p></td></tr><tr class="b"><td><p> </p> <p>ConduitConfigParser should load conduit.xml found</p> <p>in classpath if null filename is passed, if not found</p> <p>should throw Exception</p></td><td>+ve</td><td>Yes</td><td></td><td></td></tr><tr class="a"><td><p> </p> <p>Cluster should have all the fields as per Contract,</p> <p>e.g: hdfsUrl, rootdir etc</p></td><td>+ve</td><td>Yes</td><td>Part of <a href="./ConduitConfigParser.html">ConduitConfigParser</a> Tests</td><td></td></tr><tr class="b"><td><p> </p> <p>Checkpoint should be created correctly, written and</p> <p>Read Correctly</p></td><td>+ve</td><td>Yes</td><td><p>checkpoint predefined value is read</p> <p>and written correctly</p></td><td><p>provide checkpoints with predefined</p> <p>value</p></td></tr><tr class="a"><td><p> </p> <p>Conduit should read cfg file correctly, should populate</p> <p>services correctly as per xml, local, merge and purger</p> <p>services</p></td><td>+ve</td><td>Yes</td><td><p>should populate correct services</p> <p>as per predefined xml</p></td><td><p>pre defined xml with list of services</p> <p>needs to be populated</p></td></tr><tr class="b"><td>Services should return expected Milliseconds to run</td><td>+ve</td><td>Yes</td><td><p>should return milliseconds to run until</p> <p>next minute boundry</p></td><td>provide pre defined commit time</td></tr><tr class="a"><td><p> </p> <p>Services should create/publish all the Missing Paths,</p> <p>local/merge/mirror streams</p></td><td>+ve</td><td>Yes</td><td><p>all the missing paths are published</p> <p>correctly from the dummy path</p> <p>creation to now</p></td><td><p>create a pre defined path at an</p> <p>earlier date aka dummy path</p></td></tr><tr class="b"><td><p> </p> <p>Create a LocalStreamService for one of the clusters</p> <p>for integration Tests</p></td><td>+ve</td><td>Yes</td><td><p>End to End Local Stream Service</p> <p>contracts is validated</p></td><td><p>Pre defined xml for localstream</p> <p>service only.</p></td></tr><tr class="a"><td><p> </p> <p>Create dummy paths in data directory and verify</p> <p>all the paths are correctly listed by localstreamservice</p> <p>createlisting</p></td><td>+ve</td><td>Yes</td><td><p>CreateListing returns all the expected</p> <p>paths</p></td><td><p>Create dummy paths in data</p> <p>directory and expected results.</p> <p> </p></td></tr><tr class="b"><td><p> </p> <p>Run the service using MiniMRCluster should create</p> <p>all the paths except currentfile in streams_local</p> <p>directory and make sure current file is not part of it</p></td><td>+ve</td><td>Yes</td><td><p>End to End LocalStream Service</p> <p>same as above</p></td><td></td></tr><tr class="a"><td><p> </p> <p>After running the service check that trash paths are</p> <p>populated correctly with all the paths except current</p> <p>file + 6 files</p></td><td>+ve</td><td>Yes</td><td><p>Make sure there are all files but 6</p> <p>present in trash directory</p></td><td><p>create dummy data and run</p> <p>localstream service</p></td></tr><tr class="b"><td><p> </p> <p>Make sure only 6 + current file is present in the</p> <p>data directory</p></td><td>+ve</td><td>Yes</td><td><p>Make sure 6 + current file is present</p> <p>in data directory</p></td><td><p>create dummy data and</p> <p>run localstream service</p></td></tr><tr class="a"><td><p> </p> <p>Make sure the checkpoint file is the last file in the</p> <p>streams_local directory</p></td><td>+ve</td><td>Yes</td><td><p>Make sure that current file - 1 is</p> <p>the checkpoint</p></td><td></td></tr><tr class="b"><td><p> </p> <p>Repeat the above localstream service for additional</p> <p>files in data directory</p></td><td>+ve</td><td>Yes</td><td><p>verify that there is no data replay</p> <p>all the above tests are repeated</p></td><td></td></tr><tr class="a"><td><p> </p> <p>Using the above LocalStreamService as the basis,</p> <p>test MergedStream service by defining only merged</p> <p>stream cluster</p></td><td>+ve</td><td>Yes</td><td>verify contract for merged stream</td><td></td></tr><tr class="b"><td><p> </p> <p>Run the MergedStreamService after localstreamservice</p> <p>make sure all the paths are present in streams</p> <p>directory</p></td><td>+ve</td><td>Yes</td><td>same as above</td><td></td></tr><tr class="a"><td>Verify about the <a href="./MissingPaths.html">MissingPaths</a></td><td>+ve</td><td>Yes</td><td></td><td></td></tr><tr class="b"><td><p> </p> <p>Repeat the same above for another cycle for</p> <p>mergedstreamservice</p></td><td>+ve</td><td>No</td><td></td><td></td></tr><tr class="a"><td><p> </p> <p>Define a MirrorStream service in another xml</p> <p>and run Local and <a href="./MergedStream.html">MergedStream</a> service</p></td><td>+ve</td><td>Yes</td><td>Verify contract for mirror stream</td><td></td></tr><tr class="b"><td>Verify the paths in streams folder for <a href="./MirrorStreamService.html">MirrorStreamService</a></td><td>+ve</td><td>Yes</td><td></td><td></td></tr><tr class="a"><td>Verify publishing of missing paths for <a href="./MirrorStreamService.html">MirrorStreamService</a></td><td>+ve</td><td>Yes</td><td></td><td></td></tr><tr class="b"><td>Make sure there are no exceptions for any runs above</td><td>+ve</td><td>Yes</td><td></td><td></td></tr><tr class="a"><td>Repeat the above for another run with new data</td><td>+ve</td><td>No</td><td></td><td></td></tr><tr class="b"><td>Repeat above for another run without new data</td><td>+ve</td><td>No</td><td></td><td></td></tr><tr class="a"><td><p> </p> <p>Create a Purger Test Service and verify that purging</p> <p>is done correctly for date and retentioninhours should return</p> <p>true/false respectively</p></td><td>+ve</td><td>Yes</td><td></td><td></td></tr><tr class="b"><td><p> </p> <p>Run end to end service tests for purger service, create paths in</p> <p>streams_local and run the purger service for different times and</p> <p>verify that paths are deleted or retained depending</p> <p>on retentionperiod</p></td><td>+ve</td><td>Yes</td><td></td><td></td></tr><tr class="a"><td><p> </p> <p>Run end to end service tests for purger service, create paths in</p> <p>streams and run the purger service for different times and</p> <p>verify that paths are deleted or retained depending</p></td><td>+ve</td><td>Yes</td><td></td><td></td></tr><tr class="b"><td><p> </p> <p>Run end to end service tests for purger service, create paths in</p> <p>streams and run the purger service for different times and</p> <p>verify that paths are deleted or retained depending</p></td><td>+ve</td><td>Yes</td><td></td><td></td></tr><tr class="a"><td>Run the purger service again with new data</td><td>+ve</td><td>No</td><td></td><td></td></tr><tr class="b"><td><p> </p> <p>Run the purger service again with no new data, shouldnt throw</p> <p>and exception</p></td><td>-ve</td><td>No</td><td></td><td></td></tr></table>We have following Test Cases for Respective Services Covering Different Scenarios</div><div class="section"><h3>Conduit-Core<a name="Conduit-Core"></a></h3><p>Has 64% Coverage for following Scenarios</p><p>* <a href="./TestCluster.html">TestCluster</a>.java - testBasicCluster - Uses test-conduit.xml and makes sure that teh cluster values are correctly populated with known values. For e.g hdfsurl, etc. Defines only a single cluster. Improvement of having multiple clusters defined in xml.</p><p>* <a href="./TestConduitConfigParser.html">TestConduitConfigParser</a> - Builds a localcluster of known xml test-conduit.xml and compares it to known values. Creates a new xml of known values and compares the same making sure all the values are correctly parsed.</p><p>* <a href="./TestFileCheckpointProvider.html">TestFileCheckpointProvider</a> - Creates a checkpoint and reads it making sure the checkpoint is saved correctly.</p><p>* TestFSCheckpointProvider - Tests the same as above with and without HDFS.</p></div><div class="section"><h3>Conduit-Worker<a name="Conduit-Worker"></a></h3><p>Has 68% Coverage for following Scenarios</p><p>* <a href="./AbstractServiceTest.html">AbstractServiceTest</a> - Makes sure that milliseconds to next run fall on next minute boundry.</p><p>* <a href="./DataPurgerServiceTest.html">DataPurgerServiceTest</a> - Covers the following</p><p></p><ul><li>isPurgeTest* - Covers various scenarious where the time is advanced and forwarded and made sure isPurge method returns the correct status.</li></ul><p></p><ul><li>testDefaultRetentionTimes - Parses the xml test-retention-conduit.xml and makes sure the retention times are as mentioned in the xml and also verifies that for streams not defined in the xml a default value as mentioned in xml is returned.</li></ul><p></p><ul><li>testPurgerService - Creates services with different values from xml and creates test files and makes sure that merge,local and trash are cleared appropriately. Using different current times.</li></ul>* <a href="./LocalStreamServiceTest.html">LocalStreamServiceTest</a> - Covers the following<p>* <a href="./TestCreateListing.html">TestCreateListing</a> - Verfies that created files are populated correctly, trashset and checkpoints doesnt run the Mapper. Calls <a href="./LocalStreamService.html">LocalStreamService</a> <a href="./CreateListing.html">CreateListing</a> Method to Verify.</p><p>* testMapReduce - Does a Integration test for LocalStreamService, End to End. Creates the data in data folder, Runs the mapper, Verfies that all the compressed files are created, verfies that 6 files are present from checkpoint backwards, makes sure that current file is not moved. Checks for Missing Paths. Makes sure that all trash contains the expected files totalnumberoffiles - 6 - currentfile.</p><p>* <a href="./MergeMirrorStreamTest.html">MergeMirrorStreamTest</a> - Covers the following</p><p></p><ul><li>testMergeMirrorStream - Runs the service End to End for 2 xml one which defines only the MergeStream and MirrorStream for 1 cluster each and other one 1 Merge and 2 Mirror Streams, Makes sure that LocalStreamService works correctly, Makes sure that data for MergeStream is correctly published and the same for MirrorStream. Tests for Missing Paths for MergedStreamService only.</li></ul>The following are performed during the manual tests for conduit<p>1. Makes sure the debian package is correctly installed on both the dev machines.</p><p>2. Define xml which contains <a href="./MergedStream.html">MergedStream</a>, Should test <a href="./MirrorStream.html">MirrorStream</a> as well.</p><p>3. Run the benchmark test for LOCAL,COLLECTOR and MERGED and make sure data is validated in all cases.</p><p>4. Make sure data is correctly published in data folder in order and timestamps are correct.</p><p>5. Make sure localstream service correctly published data and the commit times are correct and all the files except the current file is published.</p><p>6. Verify that trash paths are correctly populated.</p><p>7. Verify the Purger service purges all the paths which exceeds retentionperiod, try with 2 hours once for trash and other for streams. Change at stream level and make sure its reflected.</p><p>8. Verify that Merged Stream service correctly publishes all the paths.</p><p>9. In all the above cases make sure there are no exceptions.</p><p>10. Pump multiple streams and verify that conduit behaves correctly and no exceptions.</p><p>11. Run benchmark for multiple streams, with multiple producers.</p></div>
      </div>
    </div>
    <div class="clear">
      <hr/>
    </div>
    <div id="footer">
      <div class="xright">
              Copyright &#169;                    2014
                        <a href="https://github.com/InMobi">InMobi</a>.
            All Rights Reserved.      
            
                  </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
  </body>
</html>
